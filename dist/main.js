!function(){"use strict";!function(){class t{constructor(t){this.sound=document.createElement("audio"),this.sound.src=t,this.sound.setAttribute("preload","auto"),this.sound.setAttribute("controls","none"),this.sound.setAttribute("muted","muted"),this.sound.style.display="none",document.body.appendChild(this.sound),this.play=function(){this.sound.play()},this.stop=function(){this.sound.pause(),this.sound.currentTime=0},this.restart=function(){this.sound.currentTime=0,this.play()},this.loop=function(){this.sound.addEventListener("ended",(t=>{this.restart()}))},this.muteToggle=()=>{this.sound.muted?this.sound.muted=!1:this.sound.muted=!0}}}function s(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}class e{constructor(e){s(this,"drawObject",(function(t){let s=new Image;s.src=this.image,t.drawImage(s,this.pos[0]-this.radius-this.game.cameraX,this.pos[1]-this.radius-this.game.cameraY,2*this.radius,2*this.radius)})),s(this,"spinDraw",(function(t){let s=new Image;s.src=this.image,this.drawX=this.pos[0]-this.game.cameraX,this.drawY=this.pos[1]-this.game.cameraY,this.drawX+2*this.radius>this.game.MAP_WIDTH?this.drawX=this.drawX-this.game.MAP_WIDTH:this.drawX+2*this.radius<0&&(this.drawX=this.drawX+this.game.MAP_WIDTH),this.drawY+2*this.radius>this.game.MAP_HEIGHT?this.drawY=this.drawY-this.game.MAP_HEIGHT:this.drawY+2*this.radius<0&&(this.drawY=this.drawY+this.game.MAP_HEIGHT),t.save(),t.translate(this.drawX,this.drawY),t.rotate(this.rotation),t.translate(-this.drawX,-this.drawY),t.drawImage(s,this.drawX-this.radius,this.drawY-this.radius,2*this.radius,2*this.radius),t.restore()})),s(this,"drawPoint",(function(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.pos[0]-this.game.cameraX,this.pos[1]-this.game.cameraY,1,0,2*Math.PI,!1),t.fill()})),s(this,"move",(function(){this.throttleVelocity(),this.pos[0]+=this.vel[0],this.pos[1]+=this.vel[1],this.pos=this.game.wrap(this.pos)})),s(this,"isCollidedWith",(function(t){return.9*(this.radius+t.radius)>=Math.sqrt((t.pos[0]-this.pos[0])**2+(t.pos[1]-this.pos[1])**2)})),s(this,"canBeGrabbed",(function(t){return this.radius+t.radius+10>=Math.sqrt((this.pos[0]-t.pos[0])**2+(this.pos[1]-t.pos[1])**2)})),this.pos=e.pos,this.vel=e.vel,this.radius=e.radius,this.color=e.color,this.game=e.game,this.collideSound=new t("assets/sounds/collision.wav"),this.maxVelocity=6}drawShrunk(t){t.fillStyle=this.color,t.beginPath(),t.arc(this.pos[0]/this.game.MAP_WIDTH*200,this.pos[1]/this.game.MAP_WIDTH*200,3,0,2*Math.PI,!1),t.fill()}throttleVelocity(){for(let t=0;t<2;t++)this.vel[t]>this.maxVelocity?this.vel[t]=this.maxVelocity:this.vel[t]<-this.maxVelocity&&(this.vel[t]=-this.maxVelocity)}randomVec(t){const s=2*Math.PI*Math.random();return this.scale([Math.sin(s),Math.cos(s)],t)}randomRotation(){return 2*Math.random()*Math.PI/180}scale(t,s){return[t[0]*s,t[1]*s]}stepRotation(){this.rotation+=this.rotationSpeed}bounce(){this.vel[0]=-this.vel[0],this.vel[1]=-this.vel[1],this.pos[0]+=5*this.vel[0],this.pos[1]+=5*this.vel[1]}resetVelocity(t){this.vel[0]=t[0],this.vel[1]=t[1]}combinePositions(t){this.pos[0]+=t[0],this.pos[1]+=t[1]}opposingAngle(t){return Math.atan2(t.pos[1]-this.pos[1],t.pos[0]-this.pos[0])+2.2}makeVector(t,s){return this.scale([Math.sin(s),Math.cos(s)],t)}toDegrees(t){return 180*t/Math.PI}toRads(t){return t*Math.PI/180}makeAngleFromVector(t){return Math.atan2(-t[1],t[0])}}class i extends e{constructor(t,s){super({color:"red",radius:70,vel:[0,0],pos:t,game:s}),this.vel=this.randomVec(3),this.rotationSpeed=.03,this.rotation=0,this.image="assets/imagery/debris.png",this.notOnMap=!0}}function a(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}class o extends e{constructor(t){super({color:"white",radius:30,vel:[0,0],pos:[600,0],game:t}),a(this,"astronautCollision",(function(t){return.5*(this.radius+t.radius)>=Math.sqrt((t.pos[0]-this.pos[0])**2+(t.pos[1]-this.pos[1])**2)})),a(this,"astronautComponentCollision",(function(t){return this.radius+t.radius>=Math.sqrt((t.pos[0]-this.pos[0])**2+(t.pos[1]-this.pos[1])**2)})),this.rotation=0,this.maxRotationSpeed=1,this.inventory=[],this.oxygen=100,this.dead=!1,this.image="assets/imagery/astronaut.png",this.pushoffSpeed=1,this.oxygenRate=1,this.loseOxygen(),this.jetpack=!0}loseOxygen(){setInterval((()=>{this.game.paused||(this.oxygen-=this.oxygenRate)}),2e3)}stick(t){t&&(this.surface=t,this.rotation=this.opposingAngle(this.surface),this.rotationSpeed=this.surface.rotationSpeed,this.vel=[...this.surface.vel])}pushOff(t){let s=this.makeVector(6,-this.rotation);this.rotation=-this.rotation,this.surface=null,this.rotationSpeed=0,this.resetVelocity(s)}putOnCircumference(t){let s=this.makeVector(t.radius,-this.rotation),e=[t.pos[0]+s[0],t.pos[1]+s[1]];this.pos=e}increasePower(){setInterval((()=>{this.pushoffSpeed<10&&(this.pushoffSpeed+=1)}),300)}resetPower(){this.pushoffSpeed=1}throttleRotation(){this.rotationSpeed>this.maxRotationSpeed&&(this.rotationSpeed=this.maxRotationSpeed),this.rotationSpeed<-this.maxRotationSpeed&&(this.rotationSpeed=-this.maxRotationSpeed)}}class h extends e{constructor(t,s){super({color:"purple",radius:40,vel:[0,0],pos:t,game:s}),this.image="assets/imagery/gear.png",this.caught=!1,this.rotation=1,this.rotationSpeed=.03}}class n extends e{constructor(t,s){super({color:"orange",radius:60,vel:[0,0],pos:t,game:s}),this.image="assets/imagery/flame_ball.gif",this.rotation=0,this.rotationSpeed=this.toRads(Math.random()*Math.PI),this.notOnMap=!0}}class r extends e{constructor(t,s){super({color:"red",radius:40,vel:[0,0],pos:t,game:s}),this.image="assets/imagery/jetpack.png",this.caught=!1,this.rotation=0,this.rotationSpeed=.03}}class u{constructor(t){this.game=t,this.makeGrid()}makeGrid(t){"easy"===this.game.difficulty?this.grid=[[1,0,0,0,1,0,0,1,0,0],[0,0,0,1,0,0,0,2,0,1],[0,0,1,0,1,0,0,1,0,0],[1,0,0,0,0,0,1,0,2,0],[0,1,0,2,0,2,0,0,0,1],[0,0,0,0,0,0,0,1,0,0],[0,0,0,1,0,1,0,0,2,0],[1,0,1,0,0,0,0,1,0,1],[0,2,0,0,0,2,0,0,0,0],[0,0,0,2,0,0,1,0,0,1]]:"medium"===this.game.difficulty?this.grid=[[1,0,2,0,0,2,0,2,0,1],[0,0,0,2,0,0,0,0,0,0],[1,0,0,2,0,2,0,0,1,0],[0,2,0,2,0,0,1,0,0,0],[0,0,0,2,0,0,1,2,0,2],[2,0,1,2,2,0,1,0,0,0],[0,1,0,2,0,2,1,0,0,2],[0,0,0,2,0,0,2,0,0,0],[0,2,0,2,0,0,0,0,1,0],[1,0,0,2,2,0,1,0,0,1]]:"hard"===this.game.difficulty&&(this.grid=[[1,0,2,0,0,2,0,2,0,1],[0,1,0,2,0,0,0,0,2,0],[1,0,0,2,0,2,0,2,0,2],[0,2,0,2,1,0,1,0,0,0],[0,0,0,2,0,2,1,2,0,2],[2,0,2,2,2,0,1,0,1,0],[0,1,0,2,0,2,1,0,0,2],[0,0,0,2,0,0,2,0,0,0],[0,2,0,2,2,0,0,0,1,2],[1,0,1,2,2,0,1,0,0,1]])}populateMap(){const t=this.game.MAP_WIDTH/10;for(let s=0;s<this.grid.length;s++)for(let e=0;e<this.grid.length;e++){let i=[t/2+e*t,t/2+s*t];switch(this.grid[s][e]){case 1:this.game.addDebris(i);break;case 2:this.game.addFlame(i)}}}}function c(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}class d{constructor(s,e,a){c(this,"addDebris",(function(t){let s=new i(t,this);this.debris.push(s)})),c(this,"addComponents",(function(){let t=[];for(let s=0;s<this.NUM_COMPONENTS;s++)t.push(new h(this.randomPosition(),this));return t})),c(this,"addFlame",(function(t){let s=new n(t,this);this.flames.push(s)})),c(this,"randomPosition",(function(){let t,s;return t=Math.floor(Math.random()*this.MAP_WIDTH),s=Math.floor(Math.random()*this.MAP_HEIGHT),[t,s]})),c(this,"draw",(function(){this.ctx.clearRect(0,0,this.CANVAS_WIDTH,this.CANVAS_HEIGHT);for(let t=0;t<this.objects.length;t++)!0!==this.objects[t].caught&&this.objects[t].spinDraw(this.ctx);this.displayOxygen(),this.drawMinimap(),this.steamMaker()})),c(this,"drawSteam",(function(t){let s=new Image;switch(t){case"left":s.src=this.steamImageLeft,this.ctx.drawImage(s,this.astronaut.pos[0]-this.cameraX+this.astronaut.radius,this.astronaut.pos[1]-this.cameraY-this.astronaut.radius/2,this.astronaut.radius,this.astronaut.radius),console.log("drewsteam");break;case"right":s.src=this.steamImageRight,this.ctx.drawImage(s,this.astronaut.pos[0]-this.cameraX-2*this.astronaut.radius,this.astronaut.pos[1]-this.cameraY-this.astronaut.radius/2,this.astronaut.radius,this.astronaut.radius),console.log("steamright");break;case"up":s.src=this.steamImageUp,this.ctx.drawImage(s,this.astronaut.pos[0]-this.cameraX-this.astronaut.radius/2,this.astronaut.pos[1]-this.cameraY+this.astronaut.radius,this.astronaut.radius,this.astronaut.radius);break;case"down":s.src=this.steamImageDown,this.ctx.drawImage(s,this.astronaut.pos[0]-this.cameraX-this.astronaut.radius/2,this.astronaut.pos[1]-this.cameraY-2*this.astronaut.radius,this.astronaut.radius,this.astronaut.radius)}})),c(this,"moveObjects",(function(){this.astronaut.surface?this.astronaut.putOnCircumference(this.astronaut.surface):this.gameOver||(this.astronaut.rotation=2.1-this.astronaut.makeAngleFromVector(this.astronaut.vel));for(let t=0;t<this.objects.length;t++)this.objects[t].move(),this.objects[t].stepRotation()})),c(this,"wrap",(function(t){for(let s=0;s<t.length;s++)t[s]<0&&(t[s]+=this.MAP_WIDTH),t[s]>this.MAP_WIDTH&&(t[s]-=this.MAP_WIDTH);return t})),c(this,"checkCollisions",(function(){for(let t=0;t<this.debris.length;t++)for(let s=t+1;s<this.debris.length;s++)this.debris[t].isCollidedWith(this.debris[s])&&(this.debris[t].bounce(),this.debris[s].bounce())})),c(this,"checkAstronautCollision",(function(){if(!this.astronaut.surface)for(let t=0;t<this.debris.length;t++)this.astronaut.astronautCollision(this.debris[t])&&(this.debris[t].bounce(),this.astronaut.bounce())})),c(this,"checkFlameCollision",(function(){for(let t=0;t<this.flames.length;t++)this.astronaut.astronautCollision(this.flames[t])&&(this.astronaut.oxygen=0)})),c(this,"componentPickup",(function(){for(let t=0;t<this.components.length;t++)this.astronaut.astronautComponentCollision(this.components[t])&&(this.components[t].caught=!0,this.components[t].pos=[NaN,NaN],this.collectSound.play(),this.components[t]instanceof r?this.astronaut.jetpack=!0:this.astronaut.inventory.push(this.components[t]))})),c(this,"removeCaught",(function(){for(let t=0;t<this.components.length;t++)this.components[t].caught&&this.components.splice(t,1)})),c(this,"grabbableObject",(function(){let t=[];for(let s=0;s<this.debris.length;s++)this.debris[s].canBeGrabbed(this.astronaut)&&t.push(this.debris[s]);return t[0]})),c(this,"step",(()=>{this.gameView.checkKeyState(),this.moveObjects(),this.removeCaught(),this.setCamera(),this.componentPickup(),!1===this.gameOver&&(this.checkGameOver(),this.checkCollisions(),this.checkAstronautCollision(),this.checkFlameCollision(),this.astronaut.throttleRotation())})),c(this,"runGame",(()=>{!1===this.paused&&!1===this.gameOff&&(this.step(),this.draw(),this.gameOver&&this.displayEndMessage()),window.requestAnimationFrame(this.runGame)})),c(this,"launchSequence",(()=>{this.launchSound.play(),this.escapePod.image="assets/imagery/escape_pod_launched.gif",this.escapePod.vel=[-15,-15],this.escapePod.rotation=2*Math.PI*.85,this.escapePod.rotationSpeed=0,this.astronaut.rotationSpeed=0,this.astronaut.caught=!0,this.astronaut.oxygen=100,this.astronaut.oxygenRate=0})),this.difficulty=a,this.gameView=e,this.CANVAS_WIDTH=s.canvas.width,this.CANVAS_HEIGHT=s.canvas.height,this.ctx=s,this.gameOver=!1,this.MAP_WIDTH=2e3,this.MAP_HEIGHT=2e3,this.NUM_DEBRIS=15,this.setNumberComponents(),this.NUM_FLAMES=5,this.debris=[],this.flames=[],this.level=new u(this),this.level.populateMap(),this.astronaut=new o(this),this.setStartingDebris(),this.setDestinationDebris(),this.components=this.addComponents(),this.addJetpack(),this.objects=this.allObjects(),this.paused=!1,this.deathSound=new t("assets/sounds/death_rattle.wav"),this.collectSound=new t("assets/sounds/collect.wav"),this.repairSound=new t("assets/sounds/repair.wav"),this.launchSound=new t("assets/sounds/launch.wav"),this.steamImageLeft="assets/imagery/steam.png",this.steamImageRight="assets/imagery/steam_right.png",this.steamImageUp="assets/imagery/steam_up.png",this.steamImageDown="assets/imagery/steam_down.png"}setCamera(){this.astronaut.surface?(this.cameraX=-(this.CANVAS_WIDTH/2-this.astronaut.surface.pos[0]),this.cameraY=-(this.CANVAS_HEIGHT/2-this.astronaut.surface.pos[1])):(this.cameraX=-(this.CANVAS_WIDTH/2-this.astronaut.pos[0]),this.cameraY=-(this.CANVAS_HEIGHT/2-this.astronaut.pos[1]))}allObjects(){let t=[];return t=t.concat(this.debris).concat(this.flames).concat(this.components).concat(this.astronaut),t}setNumberComponents(){switch(this.difficulty){case"easy":this.NUM_COMPONENTS=3;break;case"medium":this.NUM_COMPONENTS=5;break;case"hard":this.NUM_COMPONENTS=7}}addJetpack(){this.jetpack=new r(this.randomPosition(),this),this.components.push(this.jetpack)}randomObjectSelector(t){return Math.floor(Math.random()*t.length)}setStartingDebris(){let t=this.randomObjectSelector(this.debris);this.debris[t].vel=[0,0],this.debris[t].color="yellow",this.debris[t].rotationSpeed=.02,this.astronaut.stick(this.debris[t])}setDestinationDebris(){let t=this.randomObjectSelector(this.debris);this.escapePod=this.debris[t],this.escapePod.vel=[0,0],this.escapePod.color="green",this.escapePod.image="assets/imagery/escape_pod.gif",this.escapePod.rotationSpeed=.01,this.escapePod.notOnMap=!1}steamMaker(){this.steamLeft&&this.drawSteam("left"),this.steamRight&&this.drawSteam("right"),this.steamUp&&this.drawSteam("up"),this.steamDown&&this.drawSteam("down")}displayOxygen(){this.ctx.font="40px space_age",this.ctx.fillStyle=this.astronaut.oxygen<10?"red":"green",this.ctx.fillText(`Oxygen: ${this.astronaut.oxygen<=0?"0":this.astronaut.oxygen.toFixed()}%`,50,50)}drawMinimap(){const t=document.getElementById("minimap").getContext("2d");t.clearRect(0,0,200,200);for(let s=0;s<this.objects.length;s++)this.objects[s].notOnMap||this.objects[s].drawShrunk(t)}checkGameOver(){this.astronaut.oxygen<=0?this.gameLost():this.astronaut.surface===this.escapePod&&this.astronaut.inventory.length>=this.NUM_COMPONENTS&&this.gameWon()}gameLost(){this.gameOver=!0,this.deathSound.play(),this.astronaut.image="assets/imagery/dead_transparent.png",this.astronaut.radius=60,this.astronaut.surface=null,this.astronaut.vel=[1,1],this.astronaut.rotationSpeed=.03}gameWon(){this.winner=!0,this.gameOver=!0,this.repairSound.play(),setTimeout(this.launchSequence,6e3)}displayEndMessage(){this.gameOver&&(this.ctx.font="40px space_age",this.ctx.fillStyle=this.winner?"green":"red",this.ctx.fillText(this.winner?"You win!":"Game Over",this.CANVAS_WIDTH/2+100,this.CANVAS_HEIGHT/2+10))}}function l(t,s,e){return s in t?Object.defineProperty(t,s,{value:e,enumerable:!0,configurable:!0,writable:!0}):t[s]=e,t}class m{constructor(s,e){l(this,"startGame",(()=>{this.loadsounds(),this.startSound.play(),setTimeout((()=>this.startup()),2e3)})),l(this,"restart",(()=>{this.music.stop(),this.startSound.play(),this.game.gameOff=!0,setTimeout((()=>{this.toggleScreen("start-menu",!0),this.toggleScreen("game-canvas",!1),this.toggleScreen("minimap",!1)}),1e3)})),l(this,"startup",(()=>{this.game=new d(this.ctx,this,this.difficulty),this.astronaut=this.game.astronaut,this.game.gameOff=!1,this.game.paused=!1,this.lobbyMusic.stop(),this.music.play(),this.music.loop(),this.toggleScreen("start-menu",!1),this.toggleScreen("game-canvas",!0),this.toggleScreen("minimap",!0),this.keyState={" ":!1,ArrowLeft:!1,ArrowRight:!1,ArrowUp:!1,ArrowDown:!1},window.addEventListener("keydown",(t=>{this.game.gameOver||Object.keys(this.keyState).includes(t.key)&&(this.keyState[t.key]=!0)})),window.addEventListener("keyup",(t=>{Object.keys(this.keyState).includes(t.key)&&(this.keyState[t.key]=!1),this.game.gameOver||" "===t.key&&(this.astronaut.surface&&(this.astronaut.pushOff(this.astronaut.surface),this.chargingUp.stop(),this.jumping.play()),this.astronaut.resetPower()),"ArrowLeft"===t.code&&(this.game.steamLeft=!1),"ArrowRight"===t.code&&(this.game.steamRight=!1),"ArrowUp"===t.code&&(this.game.steamUp=!1),"ArrowDown"===t.code&&(this.game.steamDown=!1)})),document.getElementById("mute").addEventListener("click",this.music.muteToggle),document.getElementById("pause").addEventListener("click",this.togglePause),document.getElementById("restart").addEventListener("click",this.restart),document.getElementById("start-menu").addEventListener("click",this.lobbySound),window.requestAnimationFrame(this.game.runGame)})),l(this,"lobbySound",(function(){this.game.gameOff&&this.lobbyMusic.play()})),l(this,"togglePause",(()=>{!0===this.game.paused?this.game.paused=!1:this.game.paused=!0})),l(this,"checkKeyState",(()=>{Object.keys(this.keyState).forEach((t=>{this.keyState[t]&&!this.game.gameOver&&this.runKeyAction(t)}))})),l(this,"runKeyAction",(t=>{switch(t){case" ":this.astronaut.surface?(this.astronaut.resetPower(),this.astronaut.increasePower()):this.game.grabbableObject!==[]&&(this.astronaut.stick(this.game.grabbableObject()),this.grunt.play());break;case"ArrowLeft":!this.astronaut.surface&&this.astronaut.jetpack&&(this.astronaut.vel[0]-=.08,this.jetpack.play(),this.astronaut.oxygen-=.1,this.game.steamLeft=!0);break;case"ArrowRight":!this.astronaut.surface&&this.astronaut.jetpack&&(this.astronaut.vel[0]+=.08,this.jetpack.play(),this.astronaut.oxygen-=.1,this.game.steamRight=!0);break;case"ArrowUp":!this.astronaut.surface&&this.astronaut.jetpack&&(this.astronaut.vel[1]-=.08,this.jetpack.play(),this.astronaut.oxygen-=.1,this.game.steamUp=!0);break;case"ArrowDown":!this.astronaut.surface&&this.astronaut.jetpack&&(this.astronaut.vel[1]+=.08,this.jetpack.play(),this.astronaut.oxygen-=.1,this.game.steamDown=!0)}})),this.music=new t("assets/sounds/80s_theme.mp3"),this.lobbyMusic=new t("assets/sounds/september_song.mp3"),this.button=new t("assets/sounds/button.ogg"),this.ctx=s,this.difficulty=e}loadsounds(){this.instructions=new t("assets/sounds/instructions.wav"),this.chargingUp=new t("assets/sounds/charging_up.wav"),this.jumping=new t("assets/sounds/jumping.wav"),this.grunt=new t("assets/sounds/grunt.mp3"),this.startSound=new t("assets/sounds/door_open.wav"),this.jetpack=new t("assets/sounds/jetpack.wav")}toggleScreen(t,s){let e=s?"block":"none";document.getElementById(t).style.display=e}}document.addEventListener("DOMContentLoaded",(function(){const s=new t("assets/sounds/button.ogg"),e=new t("assets/sounds/selected.wav"),i=(new t("assets/sounds/september_song.mp3"),document.getElementById("game-canvas"));i.height=window.innerHeight,i.width=window.innerWidth;const a=i.getContext("2d");let o="easy";const h=function(t){console.log(t.target.control.value),t.target.control.checked=!0,o=t.target.control.value,e.play()};document.getElementById("easy-button").addEventListener("click",h),document.getElementById("medium-button").addEventListener("click",h),document.getElementById("hard-button").addEventListener("click",h);const n=document.getElementById("start-button");n.addEventListener("mouseover",(function(){s.play()})),n.addEventListener("click",(function(){const t=new m(a,o);document.body.requestFullscreen(),t.startGame()}))}))}()}();
//# sourceMappingURL=main.js.map